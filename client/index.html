<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="libs/phaser.js"></script>
<!-- <script type="text/javascript" src="//cdnjs.buttflare.com/ajax/libs/lodash.js/2.4.1/lodash.js"></script> -->
<script type="text/javascript" src="libs/lodash.js"></script>
<script type="text/javascript" src="global.js"></script>
<script type="text/javascript" src="piece.js"></script>
<script type="text/javascript" src="logic.js"></script>
<script type="text/javascript" src="move.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript" src="fb.js"></script>
  <title></title>
</head>
<body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1468388983449543',
      xfbml      : true,
      version    : 'v2.1'
    });

    function onLogin(response) {
      if (response.status == 'connected') {
        // FB.api('/me?fields=id', function(data) {
          // var welcomeBlock = document.getElementById('fb-welcome');
          // welcomeBlock.innerHTML = 'Hello, ' + data.first_name + '!';
          onConnected(FB.getAuthResponse());
        // });
      }
    }


    FB.getLoginStatus(function(response) {
      // Check login status on load, and if the user is
      // already logged in, go directly to the welcome message.
      if (response.status == 'connected') {
        onLogin(response);
      } else {
        // Otherwise, show Login dialog first.
        FB.login(function(response) {
          onLogin(response);
        }, {scope: 'user_friends, email'});
      }
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


  function onConnected(privateData) {
    var p = document.createElement('a');
    p.href = window.location.href;
    var allGetElements = p.search.split("?")[1].split("&");

    var data = {};
    allGetElements.map(function(val) {
      var tmp = val.split("=");
      data[tmp[0]] = tmp[1];
    });
    // GET https://graph.facebook.com/<USER_ID>/apprequests?fields=id,application,to,from,data,message,action_type,object,created_time&access_token=APP_ACCESS_TOKEN

    // http://graph.facebook.com/<REQUEST_OBJECT_ID>?fields=data&access_token=USER_ACCESS_TOKEN

    if(data.request_ids) {
      FB.api("/" + data.request_ids + "?fields=data&access_token" + privateData.accessToken, function(val) {
        console.log(val);
      });
      // FB.api(privateData.userID + '/apprequests?fields=id,application,to,from,data,message,action_type,object,created_time&access_token=' + privateData.accessToken, function(val) {
      //   console.log(val);
      // });
    } else {
      opponent.sendTurn();
    }
  }
</script>
<h1 id="fb-welcome"></h1>
</body>
</html>
